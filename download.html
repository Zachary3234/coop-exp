<!DOCTYPE html>
<html>

<head>
    <title>人机协同决策实验</title>
    <meta charset="utf-8">
    <meta http-equiv='pragma' content='no-cache' />
    <meta http-equiv='cache-control' content='no-cache' />
    <meta http-equiv='expires' content='0' />
    <script src="js/jquery-3.6.0.min.js"></script>
</head>

<body>
    <div style="text-align: center;">
        <h1>现在数据库中有测试数据数目：<span id='count'></span></h1>
        <button style="width: 100px; height: 40px; font-size: 20px;" onclick="download()">下载</button>
    </div>
    <script>
        jQuery.support.cors = true;
        var ajaxUpload = $.ajax({
            url: "https://559f0faa-50ee-4605-869c-eb432c954171.bspapp.com/http/download/check", //请求的URL
            timeout: 1000, //超时时间设置，单位毫秒
            type: 'get', //请求方式，get或post
            complete: function (XMLHttpRequest, status) { //请求完成后最终执行参数
                document.getElementById("count").innerHTML = XMLHttpRequest.responseText;
                ajaxUpload.abort();
            }
        });
        function download(){
            jQuery.support.cors = true;
            var ajaxUpload = $.ajax({
                url: "https://559f0faa-50ee-4605-869c-eb432c954171.bspapp.com/http/download", //请求的URL
                timeout: 5000, //超时时间设置，单位毫秒
                type: 'get', //请求方式，get或post
                complete: function (XMLHttpRequest, status) { //请求完成后最终执行参数
                    // console.log(XMLHttpRequest.responseText);
                    downloadCSV(XMLHttpRequest.responseText);
                    // testtext = '中文,english\r\n1,test\r\n';
                    // downloadCSV(testtext);
                    ajaxUpload.abort();
                }
            });
        }
        function downloadCSV(csvText){
            let uri = "data:text/csv;charset=utf-8,\ufeff" + encodeURIComponent(csvText);
            var link = document.createElement('a');
            link.href = uri;
            link.download =  "data.csv";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>

</html>
